{"path":"common/security-policy","templateID":1,"sharedPropsHashes":{"apiList":"ZjpPVd"},"localProps":{"reference":{"title":"セキュリティ上の制限","slug":"common/security-policy","description":"ゲームアツマールのセキュリティ上の制限について","order":5,"navi":"共通事項","contents":"<p>（本稿は以前の<a href=\"https://ch.nicovideo.jp/indies-game/blomaga/ar1152126\">ブロマガ記事</a>を再編集したものです）</p>\n<h2 id=\"概要\">概要</h2>\n<p>ゲームアツマールは安全にゲームをプレイいただくために、ゲームに対してセキュリティ上の制限をしています。</p>\n<p>この制限を「サンドボックス機能」と呼んでいます。サンドボックスとは「砂場」のような安全な環境をさす技術用語です。このサンドボックス機能によりTwitterプラグインが利用できない等、高度なゲームを作りたい方の制限になっているという声をいただいています。そこで、本稿ではそうしたかたが制限を正しく理解し、対応できるように仕様を開示します。</p>\n<h2 id=\"誰を対象にしているか\">誰を対象にしているか</h2>\n<p>高度なプラグインを使いゲーム開発をしたい人</p>\n<h2 id=\"サンドボックスはどのように実現されているか\">サンドボックスはどのように実現されているか</h2>\n<p>ゲームアツマールは3層のiframeを重ねてゲームページを描画しています。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/layers.jpg\" alt=\"構造図\"></p>\n<h3 id=\"前面-webサービスレイヤ\">前面 webサービスレイヤ</h3>\n<p>ユーザーの目に触れるwebパーツが描画されているレイヤです。</p>\n<h3 id=\"中間-コメントエンジンレイヤ\">中間 コメントエンジンレイヤ</h3>\n<p>前面や最奥のレイヤと通信を行い、webサービス独自の機能を付加するためのレイヤです。たとえばwebサービスレイヤの「コメントOFF」命令を受け取り、ゲームレイヤで描画しているコメントを消します。</p>\n<h3 id=\"最奥-ゲームレイヤ\">最奥 ゲームレイヤ</h3>\n<p>RPGツクールMVが動作しているレイヤです。コメント描画もこのレイヤで行っています。</p>\n<p>コメントエンジンレイヤとゲームレイヤにはCSP (Content Security Policy) とSame Origin Policyを設定しています。</p>\n<p>また、投稿されたゲームデータを精査し、安全なファイル形式のみを公開しています。</p>\n<h2 id=\"サンドボックス下の制限\">サンドボックス下の制限</h2>\n<ul>\n<li><p><strong>ゲーム配信サーバ以外へのインターネットアクセスを制限しています</strong></p>\n</li>\n<li><p>回避策：特にありません。</p>\n</li>\n<li><p><strong>window.alertやwindow.prompt等のmodalウィンドウを制限しています</strong></p>\n</li>\n<li><p>回避策：ピクチャ機能等、RPGツクールMVの標準機能をご利用ください</p>\n</li>\n<li><p><strong>ページ遷移や別windowの表示を制限しています</strong></p>\n</li>\n<li><p>回避策：特にありません。</p>\n</li>\n<li><p><strong>iframeを使用することができません</strong></p>\n</li>\n<li><p>別ドメインのデータ読み込みになるため、制限しています。</p>\n</li>\n<li><p>回避策：特にありません。</p>\n</li>\n<li><p><strong>許可されたファイル形式しか投稿できない</strong></p>\n</li>\n<li><p>ヘルプに記載されたファイル形式しか投稿できません。</p>\n</li>\n<li><p>ファイル形式は拡張子ではなく中身をチェックしています。</p>\n</li>\n<li><p>回避策：特にありません。jpegファイルのpng拡張子偽装のみ特別に許可しています</p>\n</li>\n</ul>\n<h2 id=\"緩和された制限\">緩和された制限</h2>\n<ul>\n<li>HTML埋め込みのインラインスクリプトの許可</li>\n<li>data-urlとblobをjs等のスクリプトとして利用可能に</li>\n<li>blobを画像として利用可能に</li>\n<li>data-url/blobを動画/音声として利用可能に</li>\n<li>WebWorkerの許可</li>\n<li>Pointer Lock API/Orientation APIの許可</li>\n</ul>\n<p>※ブラウザによって利用できる機能に差異があります。</p>\n<h2 id=\"おわりに\">おわりに</h2>\n<p>セキュリティ上の制限はユーザーを守るために欠かせないものです。\nしかし、窮屈なゲーム制作環境を提供したいわけではありません。</p>\n<p>ですので、ユーザーの安全に影響しない限定的な制限解除については、前向きに検討していきたいとおもっています。性質上どうしても時間がかかるものではあるのですが、一緒に良い環境を作れたらと考えています。</p>\n<h2 id=\"参考\">参考</h2>\n<ul>\n<li><p>CSP (Content Security Policy) - Web セキュリティ | MDN</p>\n</li>\n<li><p><a href=\"https://developer.mozilla.org/ja/docs/Web/Security/CSP\">https://developer.mozilla.org/ja/docs/Web/Security/CSP</a></p>\n</li>\n<li><p>同一オリジンポリシー - Web セキュリティ | MDN</p>\n</li>\n<li><p><a href=\"https://developer.mozilla.org/ja/docs/Web/Security/Same-origin_policy\">https://developer.mozilla.org/ja/docs/Web/Security/Same-origin_policy</a></p>\n</li>\n</ul>\n<h2 id=\"最終更新日\">最終更新日</h2>\n<ul>\n<li>2020/02/28</li>\n</ul>\n"},"title":"セキュリティ上の制限","path":"/common/security-policy"}}
